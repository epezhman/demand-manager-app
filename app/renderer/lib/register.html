<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>TUM Demand Manager</title>
    <link rel="shortcut icon" href="../../assets/img/icon.ico">
</head>
<body>
Register
<script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>
<script>
    const {ipcRenderer, remote} = require('electron')
    const enums = remote.require('./lib/enums')
    const config = remote.require('./config')
    const notify = remote.require('./lib/notify')
    const ConfigStore = remote.require('configstore')
    const windows = remote.require('./main/windows')

    const conf = new ConfigStore(config.APP_SHORT_NAME)

    var firebaseConfig = {
        apiKey: config.FIREBASE_API_KEY,
        authDomain: config.FIREBASE_AUTH_DOMAIN
    }
    firebase.initializeApp(firebaseConfig)

    function refreshWithEmail(email) {
        //conf.set('register-email', email)
        notify('You successfully registered, we will inform you in case you win! :)')
        windows.main.init(enums.WindowType.REGISTER)
        window.close()
    }

    ipcRenderer.on('register', function (event, registerType) {

        var provider = null
        if (registerType === enums.RegisterType.GOOGLE) {
            provider = new firebase.auth.GoogleAuthProvider()
        }
        else if (registerType === enums.RegisterType.GITHUB) {
            provider = new firebase.auth.GithubAuthProvider()
        }
        firebase.auth().signInWithPopup(provider)
                .then(function (result) {
                    return refreshWithEmail(result.user.email)
                }).catch(function (error) {

            if (error.email) {
                return refreshWithEmail(error.email)
            }
            notify(error.code)
            return window.close()
        })
    })


</script>

</body>
</html>
